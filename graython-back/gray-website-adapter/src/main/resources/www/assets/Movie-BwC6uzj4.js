import{b as oe,E as ne,q as se,f as ie,d as re,e as ue,h as ce,i as de,j as me,k as pe}from"./element-plus-D_LIGSL8.js";import{_ as ve}from"./GWSearchCondition-uTmIvzrE.js";import{_ as D,g as T,a as fe}from"./index-CO_KhjXY.js";import{u as _e}from"./vue-router-DaOdIdNP.js";import{m as ge,p as he,a as ye,b as we,c as xe}from"./movie-BY9qVLn2.js";import{c as m,D as ke,o as d,d as q,I as be,r as s,h as G,a as i,u as f,S as Ve,M as U,a7 as I,Q as $,P as r,U as R,L as n,ab as Ce,H as Ne,w as ze,b as Fe,V as Se,ah as Me,T as W,at as Ue,au as $e}from"./@vue-BV9Q_yhH.js";import"./lodash-es-BDpUAi6D.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-DVUPgnhb.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-DgtNr1CL.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";/* empty css                             */import"./pinia-CWZPuNdE.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-BcRweBTn.js";import"./request_website-D1CVj42G.js";const Ee={},Ie={class:"gw-flex-container"};function Re(p,u){return d(),m("div",Ie,[ke(p.$slots,"flex-items",{},void 0,!0)])}const Be=D(Ee,[["render",Re],["__scopeId","data-v-55ab031e"]]),De={class:"gw-flex-item"},Ae={class:"gw-flex-card"},Pe={class:"img-card"},Te=["src"],Ge=["fileName"],We={class:"gw-flex-info"},qe={class:"movie-title"},Le=q({__name:"GWFlexMovieCard",props:{movie:{},play:{type:Function},click:{type:Function}},setup(p){const u=p,{movie:a}=be(u),b=s(a.value.previewUrl),V=s(a.value.title),_=s(!1);let y=G(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function C(){if(u!=null&&u.click){const e=Ce(a.value);u.click(e)}}function N(){_.value=!_.value}function z(e){const c=e.target;V.value=a.value.title+"_"+c.innerHTML,b.value=a.value.previewUrl+"/"+c.getAttribute("fileName"),F()}function F(){u!=null&&u.play&&u.play({name:V.value,url:T()+b.value})}let w=G(()=>{if(a.value.files)return a.value.files.map(e=>{const[c,x]=e.name.split("-");return{...e,chapter:c,title:x}})});return(e,c)=>{const x=oe;return d(),m("div",De,[i("div",Ae,[i("div",Pe,[i("img",{onclick:C,src:f(T)()+f(a).coverUrl,onerror:"this.onerror=null;this.src='/favicon.png';",alt:"Sorry, something went wrong"},null,8,Te),i("div",{class:"overlay",style:Ve({display:_.value?"flex":"none"})},[(d(!0),m(U,null,I(f(w),(v,S)=>(d(),$(x,{class:"item",effect:"dark",content:v.title,placement:"top",key:S},{default:r(()=>[i("div",{class:"overlay-item",onclick:z,fileName:v.value},R(v.chapter),9,Ge)]),_:2},1032,["content"]))),128))],4)]),i("div",We,[n(x,{class:"item",effect:"dark",content:f(a).title+f(y),placement:"bottom"},{default:r(()=>[i("h3",qe,R(f(a).title)+R(f(y)),1)]),_:1},8,["content"]),f(a).series=="是"?(d(),m("h3",{key:0,class:"movie-play",onclick:N}," 剧集 ")):(d(),m("h3",{key:1,class:"movie-play",onclick:F},"Play"))])])])}}}),je=D(Le,[["__scopeId","data-v-32637a18"]]),L=p=>(Ue("data-v-69cd7886"),p=p(),$e(),p),He={class:"movie-root-container"},Ke={class:"flex-item"},Oe={class:"flex-item"},Qe=L(()=>i("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Je={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Xe={class:"flex-item",style:{"margin-left":"20px"}},Ye=L(()=>i("span",{width:"30px"},null,-1)),Ze={style:{width:"100%","margin-top":"1rem"}},el=q({__name:"Movie",setup(p){_e();const u=s(0),a=s(1),b=s(10),V=s(),_=s(!1),y=s(),C=s(),N=s(),z=s(),F=s(),w=s(),e=s(),c=s({name:"",folderName:"",url:""}),x=Ne({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),v=s(!1),S=()=>{v.value=!1},j=()=>{v.value=!0},H=async o=>{o&&await o.validate(async(t,g)=>{t?(we(c.value),S()):console.log("error submit!",g)})},K=o=>{y.value=o.title,C.value=o.previewUrl,N.value=o.id,A.value.click()},O=o=>{y.value=o.name,C.value=o.url,_.value=!0},Q=o=>{a.value=o,B()},B=async()=>{await he({pageNo:a.value,pageSize:b.value,folderName:w.value,name:e.value}).then(o=>{V.value=o.data.result,u.value=o.data.total})},A=s(),J=async o=>{if(N.value){const t=o.target;if(t.files&&t.files[0]){const g=new FileReader;g.onload=h=>{var M;(M=h.target)==null||M.result},g.readAsDataURL(t.files[0]);let k=new FormData;k.append("file",t.files[0]),k.append("id",N.value+""),await ye(k).then(h=>{h.data&&ne({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},X=()=>{_.value=!1};ze(()=>[w.value,e.value],()=>{B()},{deep:!0,immediate:!0});const Y=()=>{xe()};return Fe(async()=>{B(),await ge({type:1}).then(o=>{z.value=o.data})}),(o,t)=>{const g=re,k=ue,h=ce,M=fe,Z=ve,ee=Me("GWPreviewVideo"),le=se,E=de,P=me,te=pe,ae=ie;return d(),m(U,null,[i("div",He,[n(Z,null,{"left-items":r(()=>[i("div",Ke,[n(k,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:r(()=>[(d(!0),m(U,null,I(z.value,l=>(d(),$(g,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(h,{style:{"margin-left":"10px"},modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value=l),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":r(()=>[i("div",Oe,[Qe,i("span",Je,R(u.value),1),i("div",Xe,[n(M,{size:20,"icon-class":"m3u8",class:"svg-icon",onclick:j}),Ye,n(M,{size:20,"icon-class":"refresh",class:"svg-icon",onclick:Y})])])]),_:1}),n(Be,{style:{"min-height":"calc(100% - 100px)","justify-content":"space-around"}},{"flex-items":r(()=>[(d(!0),m(U,null,I(V.value,(l,ll)=>(d(),$(je,{click:K,play:O,movie:l},null,8,["movie"]))),256))]),_:1}),i("input",{ref_key:"fileselectRef",ref:A,style:{display:"none"},type:"file",accept:"image/*",onChange:J},null,544),_.value?(d(),$(ee,{key:0,url:C.value,name:y.value,"on-close":X},null,8,["url","name"])):Se("",!0),i("div",Ze,[n(le,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:u.value,"pager-count":5,"page-size":b.value,"current-page":a.value,onCurrentChange:Q},null,8,["total","page-size","current-page"])])]),n(ae,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=l=>v.value=l),width:"500px",onClose:S},{default:r(()=>[n(te,{ref_key:"m3u8FormRef",ref:F,model:c.value,"label-width":"auto",rules:x},{default:r(()=>[n(E,{label:"电影名称：",prop:"name"},{default:r(()=>[n(h,{modelValue:c.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>c.value.name=l),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),n(E,{label:"所属分类：",prop:"folderName"},{default:r(()=>[n(k,{modelValue:c.value.folderName,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value.folderName=l),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:r(()=>[(d(!0),m(U,null,I(z.value,l=>(d(),$(g,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(E,{label:"解析地址：",prop:"url"},{default:r(()=>[n(h,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:c.value.url,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value.url=l),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),n(E,{style:{"flex-direction":"column"}},{default:r(()=>[n(P,{onClick:S},{default:r(()=>[W("取消")]),_:1}),n(P,{type:"primary",onClick:t[5]||(t[5]=l=>H(F.value))},{default:r(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),wl=D(el,[["__scopeId","data-v-69cd7886"]]);export{wl as default};
