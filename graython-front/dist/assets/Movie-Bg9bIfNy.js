import{b as te,E as le,r as ae,g as oe,e as se,f as ne,i as ie,j as re,k as ue,l as ce}from"./element-plus-CJC0wB9Y.js";import{_ as de}from"./GWSearchCondition-CIx4mKiF.js";import{_ as B,g as G,a as me}from"./index-Z1z0Xi6j.js";import{u as pe}from"./vue-router-CN4d8vP8.js";import{m as ve,p as fe,a as _e,b as ge,c as he}from"./movie-QEd9QjnN.js";import{c as d,D as ye,o as u,d as q,I as xe,r as s,h as L,a as r,u as v,S as we,M as F,a7 as $,Q as E,P as i,U as I,L as o,ab as be,H as ke,w as Ve,b as Ce,V as Ne,T as W,at as ze,au as Fe}from"./@vue-l7diRTBz.js";import{P as Me}from"./index-BTJ1Kaxa.js";import"./lodash-es-CZlvcgvt.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-B8VPWXef.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-C5UfBZZn.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-UVQjpmfQ.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-lua1maMu.js";import"./request_website-CMqNXLPX.js";import"./file-saver-CJAWeVrG.js";const Se={},Ue={class:"gw-flex-container"};function $e(p,c){return u(),d("div",Ue,[ye(p.$slots,"flex-items",{},void 0,!0)])}const Ee=B(Se,[["render",$e],["__scopeId","data-v-480d59aa"]]),Ie={class:"gw-flex-item"},Re={class:"gw-flex-card"},Ae={class:"img-card"},Be=["src"],De=["fileName"],Pe={class:"gw-flex-info"},Te={class:"movie-title"},Ge=q({__name:"GWFlexMovieCard",props:{movie:{},click:{type:Function}},setup(p){const c=p,{movie:a}=xe(c),k=s(a.value.previewUrl),x=s(a.value.title),V=s(!1);let M=L(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function C(){if(c!=null&&c.click){const e=be(a.value);c.click(e)}}function N(){V.value=!V.value}function S(e){const _=e.target;x.value=a.value.title+"_"+_.innerHTML,k.value=a.value.previewUrl+"/"+_.getAttribute("fileName"),f()}function f(){debugger;Me.previewVideo(G()+k.value,x.value)}let w=L(()=>{if(a.value.files)return a.value.files.map(e=>{const[_,m]=e.name.split("-");return{...e,chapter:_,title:m}})});return(e,_)=>{const m=te;return u(),d("div",Ie,[r("div",Re,[r("div",Ae,[r("img",{onclick:C,src:v(G)()+v(a).coverUrl,onerror:"this.onerror=null;this.src='';",alt:"Sorry, something went wrong"},null,8,Be),r("div",{class:"overlay",style:we({display:V.value?"flex":"none"})},[(u(!0),d(F,null,$(v(w),(g,R)=>(u(),E(m,{class:"item",effect:"dark",content:g.title,placement:"top",key:R},{default:i(()=>[r("div",{class:"overlay-item",onclick:S,fileName:g.value},I(g.chapter),9,De)]),_:2},1032,["content"]))),128))],4)]),r("div",Pe,[o(m,{class:"item",effect:"dark",content:v(a).title+v(M),placement:"bottom"},{default:i(()=>[r("h3",Te,I(v(a).title)+I(v(M)),1)]),_:1},8,["content"]),v(a).series=="是"?(u(),d("h3",{key:0,class:"movie-play",onclick:N}," 剧集 ")):(u(),d("h3",{key:1,class:"movie-play",onclick:f},"Play"))])])])}}}),Le=B(Ge,[["__scopeId","data-v-d6fecea8"]]),j=p=>(ze("data-v-5645d2ab"),p=p(),Fe(),p),We={class:"movie-root-container"},qe={class:"flex-item"},je={class:"flex-item"},He=j(()=>r("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Ke={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Oe={class:"flex-item",style:{"margin-left":"20px"}},Qe=j(()=>r("span",{width:"30px"},null,-1)),Je={key:0,style:{width:"100%","margin-top":"1rem"}},Xe=q({__name:"Movie",setup(p){pe();const c=s(0),a=s(1),k=s(10),x=s([]);s(!1);const V=s(),M=s(),C=s(),N=s(),S=s(),f=s(),w=s(),e=s({name:"",folderName:"",url:""}),_=ke({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),m=s(!1),g=()=>{m.value=!1},R=()=>{m.value=!0},H=async n=>{n&&await n.validate(async(l,h)=>{l?(ge(e.value),g()):console.log("error submit!",h)})},K=n=>{V.value=n.title,M.value=n.previewUrl,C.value=n.id,D.value.click()},O=n=>{a.value=n,A()},A=async()=>{await fe({pageNo:a.value,pageSize:k.value,folderName:f.value,name:w.value}).then(n=>{x.value=n.data.result,c.value=n.data.total})},D=s(),Q=async n=>{if(C.value){const l=n.target;if(l.files&&l.files[0]){const h=new FileReader;h.onload=y=>{var z;(z=y.target)==null||z.result},h.readAsDataURL(l.files[0]);let b=new FormData;b.append("file",l.files[0]),b.append("id",C.value+""),await _e(b).then(y=>{y.data&&le({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}};Ve(()=>[f.value,w.value],()=>{A()},{deep:!0,immediate:!0});const J=()=>{he()};return Ce(async()=>{A(),await ve({type:1}).then(n=>{N.value=n.data})}),(n,l)=>{var T;const h=se,b=ne,y=ie,z=me,X=de,Y=ae,U=re,P=ue,Z=ce,ee=oe;return u(),d(F,null,[r("div",We,[o(X,null,{"left-items":i(()=>[r("div",qe,[o(b,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:i(()=>[(u(!0),d(F,null,$(N.value,t=>(u(),E(h,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(y,{style:{"margin-left":"10px"},modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=t=>w.value=t),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":i(()=>[r("div",je,[He,r("span",Ke,I(c.value),1),r("div",Oe,[o(z,{size:"20px","icon-class":"m3u8",class:"svg-icon",onclick:R}),Qe,o(z,{size:"20px","icon-class":"refresh",class:"svg-icon",onclick:J})])])]),_:1}),o(Ee,{style:{"justify-content":"space-around"}},{"flex-items":i(()=>[(u(!0),d(F,null,$(x.value,(t,Ye)=>(u(),E(Le,{key:t.id,click:K,movie:t},null,8,["movie"]))),128))]),_:1}),((T=x.value)==null?void 0:T.length)>0?(u(),d("div",Je,[o(Y,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:c.value,"pager-count":5,"page-size":k.value,"current-page":a.value,onCurrentChange:O},null,8,["total","page-size","current-page"])])):Ne("",!0),r("input",{ref_key:"fileselectRef",ref:D,style:{display:"none"},type:"file",accept:"image/*",onChange:Q},null,544)]),o(ee,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=t=>m.value=t),width:"500px",onClose:g},{default:i(()=>[o(Z,{ref_key:"m3u8FormRef",ref:S,model:e.value,"label-width":"auto",rules:_},{default:i(()=>[o(U,{label:"电影名称：",prop:"name"},{default:i(()=>[o(y,{modelValue:e.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>e.value.name=t),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),o(U,{label:"所属分类：",prop:"folderName"},{default:i(()=>[o(b,{modelValue:e.value.folderName,"onUpdate:modelValue":l[3]||(l[3]=t=>e.value.folderName=t),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:i(()=>[(u(!0),d(F,null,$(N.value,t=>(u(),E(h,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(U,{label:"解析地址：",prop:"url"},{default:i(()=>[o(y,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:e.value.url,"onUpdate:modelValue":l[4]||(l[4]=t=>e.value.url=t),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),o(U,{style:{"flex-direction":"column"}},{default:i(()=>[o(P,{onClick:g},{default:i(()=>[W("取消")]),_:1}),o(P,{type:"primary",onClick:l[5]||(l[5]=t=>H(S.value))},{default:i(()=>[W("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),ht=B(Xe,[["__scopeId","data-v-5645d2ab"]]);export{ht as default};
