import{b as se,E as ie,r as re,g as ue,e as ce,f as de,i as me,j as pe,k as ve,l as fe}from"./element-plus-CJC0wB9Y.js";import{_ as _e}from"./GWSearchCondition-DOoMQ6-R.js";import{_ as D,g as G,a as ge}from"./index-Dh-3IoMf.js";import{u as he}from"./vue-router-CN4d8vP8.js";import{m as ye,p as xe,a as we,b as ke,c as be}from"./movie-BQmorEBb.js";import{c as m,D as Ve,o as r,d as q,I as Ce,r as s,h as W,a as u,u as f,S as Ne,M as U,a7 as I,Q as $,P as i,U as R,L as n,ab as ze,H as Fe,w as Se,b as Me,V as L,aj as Ue,T as j,at as $e,au as Ee}from"./@vue-l7diRTBz.js";import"./lodash-es-CZlvcgvt.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-B8VPWXef.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-C5UfBZZn.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-UVQjpmfQ.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-lua1maMu.js";import"./request_website-fyyA1Cp4.js";const Ie={},Re={class:"gw-flex-container"};function Be(p,c){return r(),m("div",Re,[Ve(p.$slots,"flex-items",{},void 0,!0)])}const De=D(Ie,[["render",Be],["__scopeId","data-v-55ab031e"]]),Ae={class:"gw-flex-item"},Pe={class:"gw-flex-card"},Te={class:"img-card"},Ge=["src"],We=["fileName"],Le={class:"gw-flex-info"},je={class:"movie-title"},qe=q({__name:"GWFlexMovieCard",props:{movie:{},play:{type:Function},click:{type:Function}},setup(p){const c=p,{movie:a}=Ce(c),V=s(a.value.previewUrl),y=s(a.value.title),_=s(!1);let x=W(()=>{if(a.value.size){if(a.value.series=="是")return" [共"+a.value.size+"集]";{let e=a.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function C(){if(c!=null&&c.click){const e=ze(a.value);c.click(e)}}function N(){_.value=!_.value}function z(e){const d=e.target;y.value=a.value.title+"_"+d.innerHTML,V.value=a.value.previewUrl+"/"+d.getAttribute("fileName"),F()}function F(){c!=null&&c.play&&c.play({name:y.value,url:G()+V.value})}let w=W(()=>{if(a.value.files)return a.value.files.map(e=>{const[d,k]=e.name.split("-");return{...e,chapter:d,title:k}})});return(e,d)=>{const k=se;return r(),m("div",Ae,[u("div",Pe,[u("div",Te,[u("img",{onclick:C,src:f(G)()+f(a).coverUrl,onerror:"this.onerror=null;this.src='';",alt:"Sorry, something went wrong"},null,8,Ge),u("div",{class:"overlay",style:Ne({display:_.value?"flex":"none"})},[(r(!0),m(U,null,I(f(w),(v,S)=>(r(),$(k,{class:"item",effect:"dark",content:v.title,placement:"top",key:S},{default:i(()=>[u("div",{class:"overlay-item",onclick:z,fileName:v.value},R(v.chapter),9,We)]),_:2},1032,["content"]))),128))],4)]),u("div",Le,[n(k,{class:"item",effect:"dark",content:f(a).title+f(x),placement:"bottom"},{default:i(()=>[u("h3",je,R(f(a).title)+R(f(x)),1)]),_:1},8,["content"]),f(a).series=="是"?(r(),m("h3",{key:0,class:"movie-play",onclick:N}," 剧集 ")):(r(),m("h3",{key:1,class:"movie-play",onclick:F},"Play"))])])])}}}),He=D(qe,[["__scopeId","data-v-2d511cc0"]]),H=p=>($e("data-v-f4793e2e"),p=p(),Ee(),p),Ke={class:"movie-root-container"},Oe={class:"flex-item"},Qe={class:"flex-item"},Je=H(()=>u("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Xe={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Ye={class:"flex-item",style:{"margin-left":"20px"}},Ze=H(()=>u("span",{width:"30px"},null,-1)),el={key:0,style:{width:"100%","margin-top":"1rem"}},ll=q({__name:"Movie",setup(p){he();const c=s(0),a=s(1),V=s(10),y=s([]),_=s(!1),x=s(),C=s(),N=s(),z=s(),F=s(),w=s(),e=s(),d=s({name:"",folderName:"",url:""}),k=Fe({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),v=s(!1),S=()=>{v.value=!1},K=()=>{v.value=!0},O=async o=>{o&&await o.validate(async(t,g)=>{t?(ke(d.value),S()):console.log("error submit!",g)})},Q=o=>{x.value=o.title,C.value=o.previewUrl,N.value=o.id,A.value.click()},J=o=>{x.value=o.name,C.value=o.url,_.value=!0},X=o=>{a.value=o,B()},B=async()=>{await xe({pageNo:a.value,pageSize:V.value,folderName:w.value,name:e.value}).then(o=>{y.value=o.data.result,c.value=o.data.total})},A=s(),Y=async o=>{if(N.value){const t=o.target;if(t.files&&t.files[0]){const g=new FileReader;g.onload=h=>{var M;(M=h.target)==null||M.result},g.readAsDataURL(t.files[0]);let b=new FormData;b.append("file",t.files[0]),b.append("id",N.value+""),await we(b).then(h=>{h.data&&ie({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}},Z=()=>{_.value=!1};Se(()=>[w.value,e.value],()=>{B()},{deep:!0,immediate:!0});const ee=()=>{be()};return Me(async()=>{B(),await ye({type:1}).then(o=>{z.value=o.data})}),(o,t)=>{var T;const g=ce,b=de,h=me,M=ge,le=_e,te=re,ae=Ue("GWPreviewVideo"),E=pe,P=ve,oe=fe,ne=ue;return r(),m(U,null,[u("div",Ke,[n(le,null,{"left-items":i(()=>[u("div",Oe,[n(b,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:i(()=>[(r(!0),m(U,null,I(z.value,l=>(r(),$(g,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(h,{style:{"margin-left":"10px"},modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value=l),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":i(()=>[u("div",Qe,[Je,u("span",Xe,R(c.value),1),u("div",Ye,[n(M,{size:"20px","icon-class":"m3u8",class:"svg-icon",onclick:K}),Ze,n(M,{size:"20px","icon-class":"refresh",class:"svg-icon",onclick:ee})])])]),_:1}),n(De,{style:{"justify-content":"space-around"}},{"flex-items":i(()=>[(r(!0),m(U,null,I(y.value,(l,tl)=>(r(),$(He,{click:Q,play:J,movie:l},null,8,["movie"]))),256))]),_:1}),((T=y.value)==null?void 0:T.length)>0?(r(),m("div",el,[n(te,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:c.value,"pager-count":5,"page-size":V.value,"current-page":a.value,onCurrentChange:X},null,8,["total","page-size","current-page"])])):L("",!0),u("input",{ref_key:"fileselectRef",ref:A,style:{display:"none"},type:"file",accept:"image/*",onChange:Y},null,544),_.value?(r(),$(ae,{key:1,url:C.value,name:x.value,"on-close":Z},null,8,["url","name"])):L("",!0)]),n(ne,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=l=>v.value=l),width:"500px",onClose:S},{default:i(()=>[n(oe,{ref_key:"m3u8FormRef",ref:F,model:d.value,"label-width":"auto",rules:k},{default:i(()=>[n(E,{label:"电影名称：",prop:"name"},{default:i(()=>[n(h,{modelValue:d.value.name,"onUpdate:modelValue":t[2]||(t[2]=l=>d.value.name=l),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),n(E,{label:"所属分类：",prop:"folderName"},{default:i(()=>[n(b,{modelValue:d.value.folderName,"onUpdate:modelValue":t[3]||(t[3]=l=>d.value.folderName=l),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:i(()=>[(r(!0),m(U,null,I(z.value,l=>(r(),$(g,{key:l.value,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(E,{label:"解析地址：",prop:"url"},{default:i(()=>[n(h,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:d.value.url,"onUpdate:modelValue":t[4]||(t[4]=l=>d.value.url=l),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),n(E,{style:{"flex-direction":"column"}},{default:i(()=>[n(P,{onClick:S},{default:i(()=>[j("取消")]),_:1}),n(P,{type:"primary",onClick:t[5]||(t[5]=l=>O(F.value))},{default:i(()=>[j("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),xl=D(ll,[["__scopeId","data-v-f4793e2e"]]);export{xl as default};
