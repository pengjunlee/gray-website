import{b as le,E as ae,r as oe,g as se,e as ne,f as ie,i as re,j as ue,k as ce,l as de}from"./element-plus-CJC0wB9Y.js";import{_ as me}from"./GWSearchCondition-Cy8Ky0-I.js";import{_ as B,g as pe,a as ve}from"./index-DLzZvDCU.js";import{u as fe}from"./vue-router-CN4d8vP8.js";import{m as _e,p as ge,a as he,b as ye,c as we}from"./movie-BOdLRRk-.js";import{c as m,D as xe,o as c,d as W,I as be,r as n,h as G,a as r,u as f,S as ke,M as U,a7 as E,Q as I,P as i,U as R,L as s,ab as Ve,H as Ce,w as Ne,b as ze,V as Se,T as L,at as Ue,au as Fe}from"./@vue-l7diRTBz.js";import{P as Me}from"./index-KAO6tLF7.js";import"./lodash-es-CZlvcgvt.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-B8VPWXef.js";import"./dayjs-Dc0JWrkO.js";import"./@element-plus-C5UfBZZn.js";import"./@ctrl-D_sRHO8g.js";import"./@popperjs-D9SI2xQl.js";import"./pinia-UVQjpmfQ.js";import"./axios-Cm0UX6qg.js";import"./vue-pdf-embed-lua1maMu.js";import"./request_website-CohkK3U3.js";import"./file-saver-CJAWeVrG.js";const $e={},Ee={class:"gw-flex-container"};function Ie(p,d){return c(),m("div",Ee,[xe(p.$slots,"flex-items",{},void 0,!0)])}const Re=B($e,[["render",Ie],["__scopeId","data-v-55ab031e"]]),Ae={class:"gw-flex-item"},Be={class:"gw-flex-card"},De={class:"img-card"},Te=["src"],Pe=["fileName"],Ge={class:"gw-flex-info"},Le={class:"movie-title"},We=W({__name:"GWFlexMovieCard",props:{movie:{},click:{type:Function}},setup(p){const d=p,{movie:l}=be(d),F=n(l.value.previewUrl),x=n(l.value.title),b=n(!1);let k=G(()=>{if(l.value.size){if(l.value.series=="是")return" [共"+l.value.size+"集]";{let e=l.value.size/1024;if(e<1024)return" ["+e.toFixed(2)+"KB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"MB]";if(e=e/1024,e<1024)return" ["+e.toFixed(2)+"GB]"}}});function M(){if(d!=null&&d.click){const e=Ve(l.value);d.click(e)}}function V(){b.value=!b.value}function C(e){const u=e.target;x.value=l.value.title+"_"+u.innerHTML,F.value=l.value.previewUrl+"/"+u.getAttribute("fileName"),N()}function N(){Me.previewVideo("https://pengjunlee.us.kg/website-api/"+l.value.previewUrl,l.value.title)}let h=G(()=>{if(l.value.files)return l.value.files.map(e=>{const[u,y]=e.name.split("-");return{...e,chapter:u,title:y}})});return(e,u)=>{const y=le;return c(),m("div",Ae,[r("div",Be,[r("div",De,[r("img",{onclick:M,src:f(pe)()+f(l).coverUrl,onerror:"this.onerror=null;this.src='';",alt:"Sorry, something went wrong"},null,8,Te),r("div",{class:"overlay",style:ke({display:b.value?"flex":"none"})},[(c(!0),m(U,null,E(f(h),(v,z)=>(c(),I(y,{class:"item",effect:"dark",content:v.title,placement:"top",key:z},{default:i(()=>[r("div",{class:"overlay-item",onclick:C,fileName:v.value},R(v.chapter),9,Pe)]),_:2},1032,["content"]))),128))],4)]),r("div",Ge,[s(y,{class:"item",effect:"dark",content:f(l).title+f(k),placement:"bottom"},{default:i(()=>[r("h3",Le,R(f(l).title)+R(f(k)),1)]),_:1},8,["content"]),f(l).series=="是"?(c(),m("h3",{key:0,class:"movie-play",onclick:V}," 剧集 ")):(c(),m("h3",{key:1,class:"movie-play",onclick:N},"Play"))])])])}}}),je=B(We,[["__scopeId","data-v-a7b788ce"]]),j=p=>(Ue("data-v-f89e4c19"),p=p(),Fe(),p),qe={class:"movie-root-container"},He={class:"flex-item"},Ke={class:"flex-item"},Oe=j(()=>r("span",{style:{"font-size":"small",color:"var(--gw-bg-font)"}},"影片数量: ",-1)),Qe={style:{"font-size":"small",color:"var(--gw-bg-font)","font-style":"italic","font-weight":"bold","text-decoration":"underline"}},Je={class:"flex-item",style:{"margin-left":"20px"}},Xe=j(()=>r("span",{width:"30px"},null,-1)),Ye={key:0,style:{width:"100%","margin-top":"1rem"}},Ze=W({__name:"Movie",setup(p){fe();const d=n(0),l=n(1),F=n(10),x=n([]),b=n(!1),k=n(),M=n(),V=n(),C=n(),N=n(),h=n(),e=n(),u=n({name:"",folderName:"",url:""}),y=Ce({name:[{required:!0,message:"请输入电影名称",trigger:"blur"}],folderName:[{required:!0,message:"请选择电影所属分类",trigger:"blur"}],url:[{required:!0,message:"请输入m3u8 url地址",trigger:"blur"}]}),v=n(!1),z=()=>{v.value=!1},q=()=>{v.value=!0},H=async o=>{o&&await o.validate(async(a,_)=>{a?(ye(u.value),z()):console.log("error submit!",_)})},K=o=>{k.value=o.title,M.value=o.previewUrl,V.value=o.id,D.value.click()},O=o=>{debugger;k.value=o.name,M.value=o.url,b.value=!0},Q=o=>{l.value=o,A()},A=async()=>{await ge({pageNo:l.value,pageSize:F.value,folderName:h.value,name:e.value}).then(o=>{x.value=o.data.result,d.value=o.data.total})},D=n(),J=async o=>{if(V.value){const a=o.target;if(a.files&&a.files[0]){const _=new FileReader;_.onload=g=>{var S;(S=g.target)==null||S.result},_.readAsDataURL(a.files[0]);let w=new FormData;w.append("file",a.files[0]),w.append("id",V.value+""),await he(w).then(g=>{g.data&&ae({type:"info",message:"电影海报已更新，请刷新页面查看"})}).finally(()=>{})}}};Ne(()=>[h.value,e.value],()=>{A()},{deep:!0,immediate:!0});const X=()=>{we()};return ze(async()=>{A(),await _e({type:1}).then(o=>{C.value=o.data})}),(o,a)=>{var P;const _=ne,w=ie,g=re,S=ve,Y=me,Z=oe,$=ue,T=ce,ee=de,te=se;return c(),m(U,null,[r("div",qe,[s(Y,null,{"left-items":i(()=>[r("div",He,[s(w,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),clearable:"",placeholder:"分类",style:{width:"150px"}},{default:i(()=>[(c(!0),m(U,null,E(C.value,t=>(c(),I(_,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(g,{style:{"margin-left":"10px"},modelValue:e.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value=t),placeholder:"电影名称"},null,8,["modelValue"])])]),"right-items":i(()=>[r("div",Ke,[Oe,r("span",Qe,R(d.value),1),r("div",Je,[s(S,{size:"20px","icon-class":"m3u8",class:"svg-icon",onclick:q}),Xe,s(S,{size:"20px","icon-class":"refresh",class:"svg-icon",onclick:X})])])]),_:1}),s(Re,{style:{"justify-content":"space-around"}},{"flex-items":i(()=>[(c(!0),m(U,null,E(x.value,(t,et)=>(c(),I(je,{click:K,play:O,movie:t},null,8,["movie"]))),256))]),_:1}),((P=x.value)==null?void 0:P.length)>0?(c(),m("div",Ye,[s(Z,{style:{"flex-direction":"row-reverse"},background:"",layout:"prev, pager, next",total:d.value,"pager-count":5,"page-size":F.value,"current-page":l.value,onCurrentChange:Q},null,8,["total","page-size","current-page"])])):Se("",!0),r("input",{ref_key:"fileselectRef",ref:D,style:{display:"none"},type:"file",accept:"image/*",onChange:J},null,544)]),s(te,{style:{padding:"30px","max-height":"500px",overflow:"scroll"},title:"m3u8解析",modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=t=>v.value=t),width:"500px",onClose:z},{default:i(()=>[s(ee,{ref_key:"m3u8FormRef",ref:N,model:u.value,"label-width":"auto",rules:y},{default:i(()=>[s($,{label:"电影名称：",prop:"name"},{default:i(()=>[s(g,{modelValue:u.value.name,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value.name=t),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),s($,{label:"所属分类：",prop:"folderName"},{default:i(()=>[s(w,{modelValue:u.value.folderName,"onUpdate:modelValue":a[3]||(a[3]=t=>u.value.folderName=t),filterable:"",placeholder:"请选择所属分类",style:{width:"200px"}},{default:i(()=>[(c(!0),m(U,null,E(C.value,t=>(c(),I(_,{key:t.value,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s($,{label:"解析地址：",prop:"url"},{default:i(()=>[s(g,{size:"small",type:"textarea",placeholder:"解析地址",modelValue:u.value.url,"onUpdate:modelValue":a[4]||(a[4]=t=>u.value.url=t),resize:"none",rows:4},null,8,["modelValue"])]),_:1}),s($,{style:{"flex-direction":"column"}},{default:i(()=>[s(T,{onClick:z},{default:i(()=>[L("取消")]),_:1}),s(T,{type:"primary",onClick:a[5]||(a[5]=t=>H(N.value))},{default:i(()=>[L("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}}),wt=B(Ze,[["__scopeId","data-v-f89e4c19"]]);export{wt as default};
